displacement = -1.5625e-01;
stress = 3.1250e2;

override = containers.Map({'integration'}, 4);

beam_Bending_Q4_4x1_Al = Solver("Beam_Bending_Q4_4x1_Al.txt");
beam_Bending_Q4_8x2_Al = Solver("Beam_Bending_Q4_8x2_Al.txt");
beam_Bending_Q4_16x4_Al = Solver("Beam_Bending_Q4_16x4_Al.txt");
beam_Bending_Q8_4x1_Al = Solver("Beam_Bending_Q8_4x1_Al.txt");
beam_Bending_Q9_4x1_Al = Solver("Beam_Bending_Q9_4x1_Al.txt");
beam_Bending_Q8_4x1_Al_under = Solver("Beam_Bending_Q8_4x1_Al.txt", override);
beam_Bending_Q9_4x1_Al_under = Solver("Beam_Bending_Q9_4x1_Al.txt", override);

log_lengths = [log(12/4), log(12/8) log(12/16)];
subplot(1,3,1)
plot(log_lengths, [...
        log(abs(dot(beam_Bending_Q4_4x1_Al.interpolate_displacement(6, 1) - displacement, [0 1.]))/abs(displacement)), ...
        log(abs(dot(beam_Bending_Q4_8x2_Al.interpolate_displacement(6, 1) - displacement, [0 1.]))/abs(displacement)), ...
        log(abs(dot(beam_Bending_Q4_16x4_Al.interpolate_displacement(6, 1) - displacement, [0 1.]))/abs(displacement)), ...
    ], '.-', 'MarkerSize', 20);
hold on
scatter([log(12/4)],[...
        log(abs(dot(beam_Bending_Q8_4x1_Al.interpolate_displacement(6, 1) - displacement, [0 1]))/abs(displacement)), ...
    ], 30, 	[0.8500, 0.3250, 0.0980], 'filled');
scatter([log(12/4)],[...
        log(abs(dot(beam_Bending_Q9_4x1_Al.interpolate_displacement(6, 1) - displacement, [0 1]))/abs(displacement)), ...
    ], 30, [0.4660, 0.6740, 0.1880], 'filled');

scatter([log(12/4)],[...
        log(abs(dot(beam_Bending_Q8_4x1_Al_under.interpolate_displacement(6, 1) - displacement, [0 1]))/abs(displacement)), ...
    ], 30, 	[1, 0.6250, 0.3980], 'filled');
scatter([log(12/4)],[...
        log(abs(dot(beam_Bending_Q9_4x1_Al_under.interpolate_displacement(6, 1) - displacement, [0 1]))/abs(displacement)), ...
    ], 30, [0.3660, 0.9740, 0.4880], 'filled');

legend("Q4 Meshes", "Q8 Mesh", "Q9 Mesh", "Q8 under-integrated", "Q9 under-integrated");
title("Nodal Integration Dependency on Displacement Error");
ylabel("ln(error)")
xlabel("ln(element size)")

%%
subplot(1,3,2)
plot(log_lengths, [...
        log(abs(dot(beam_Bending_Q4_4x1_Al.interpolate_stress(6, 1) - stress, [0 0 1.]))/abs(displacement)), ...
        log(abs(dot(beam_Bending_Q4_8x2_Al.interpolate_stress(6, 1) - stress, [0 0 1.]))/abs(displacement)), ...
        log(abs(dot(beam_Bending_Q4_16x4_Al.interpolate_stress(6, 1) - stress, [0 0 1.]))/abs(displacement)), ...
    ], '.-', 'MarkerSize', 20);
hold on
scatter([log(12/4)],[...
        log(abs(dot(beam_Bending_Q8_4x1_Al.interpolate_stress(6, 1) - stress, [0 0 1]))/abs(displacement)), ...
    ], 30, 	[0.8500, 0.3250, 0.0980], 'filled');
scatter([log(12/4)],[...
        log(abs(dot(beam_Bending_Q9_4x1_Al.interpolate_stress(6, 1) - stress, [0 0 1]))/abs(displacement)), ...
    ], 30, [0.4660, 0.6740, 0.1880], 'filled');

scatter([log(12/4)],[...
        log(abs(dot(beam_Bending_Q8_4x1_Al_under.interpolate_stress(6, 1) - stress, [0 0 1]))/abs(displacement)), ...
    ], 30, 	[1, 0.6250, 0.3980], 'filled');
scatter([log(12/4)],[...
        log(abs(dot(beam_Bending_Q9_4x1_Al_under.interpolate_stress(6, 1) - stress, [0 0 1]))/abs(displacement)), ...
    ], 30, [0.3660, 0.9740, 0.4880], 'filled');

title("Nodal Integration Dependency on \sigma_{xy} Error");
ylabel("ln(error)")
xlabel("ln(element size)")
%%
subplot(1,3,3)
plot(log_lengths, [...
        log(abs(dot(beam_Bending_Q4_4x1_Al.interpolate_stress(6, 1) - stress, [1 0 0]))/abs(displacement)), ...
        log(abs(dot(beam_Bending_Q4_8x2_Al.interpolate_stress(6, 1) - stress, [1 0 0]))/abs(displacement)), ...
        log(abs(dot(beam_Bending_Q4_16x4_Al.interpolate_stress(6, 1) - stress, [1 0 0]))/abs(displacement)), ...
    ], '.-', 'MarkerSize', 20);
hold on
scatter([log(12/4)],[...
        log(abs(dot(beam_Bending_Q8_4x1_Al.interpolate_stress(6, 1) - stress, [1 0 0]))/abs(displacement)), ...
    ], 30, 	[0.8500, 0.3250, 0.0980], 'filled');
scatter([log(12/4)],[...
        log(abs(dot(beam_Bending_Q9_4x1_Al.interpolate_stress(6, 1) - stress, [1 0 0]))/abs(displacement)), ...
    ], 30, [0.4660, 0.6740, 0.1880], 'filled');

scatter([log(12/4)],[...
        log(abs(dot(beam_Bending_Q8_4x1_Al_under.interpolate_stress(6, 1) - stress, [1 0 0]))/abs(displacement)), ...
    ], 30, 	[1, 0.6250, 0.3980], 'filled');
scatter([log(12/4)],[...
        log(abs(dot(beam_Bending_Q9_4x1_Al_under.interpolate_stress(6, 1) - stress, [1 0 0]))/abs(displacement)), ...
    ], 30, [0.3660, 0.9740, 0.4880], 'filled');

title("Nodal Integration Dependency on \sigma_{xx} Error");
ylabel("ln(error)")
xlabel("ln(element size)")
%%
figure
%%
subplot(1,2,1)
plot(log_lengths, [...
        log(abs(dot(beam_Bending_Q4_4x1_Al.interpolate_stress(6, 1) - stress, [1 0 0]))/abs(displacement)), ...
        log(abs(dot(beam_Bending_Q4_8x2_Al.interpolate_stress(6, 1) - stress, [1 0 0]))/abs(displacement)), ...
        log(abs(dot(beam_Bending_Q4_16x4_Al.interpolate_stress(6, 1) - stress, [1 0 0]))/abs(displacement)), ...
    ], '.-', 'MarkerSize', 20);
hold on
scatter([log(12/4)],[...
        log(abs(dot(beam_Bending_Q8_4x1_Al.interpolate_stress(6, 1) - stress, [1 0 0]))/abs(displacement)), ...
    ], 30, 	[0.8500, 0.3250, 0.0980], 'filled');
scatter([log(12/4)],[...
        log(abs(dot(beam_Bending_Q9_4x1_Al.interpolate_stress(6, 1) - stress, [1 0 0]))/abs(displacement)), ...
    ], 30, [0.4660, 0.6740, 0.1880], 'filled');

scatter([log(12/4)],[...
        log(abs(dot(beam_Bending_Q8_4x1_Al_under.interpolate_stress(6, 1) - stress, [1 0 0]))/abs(displacement)), ...
    ], 30, 	[1, 0.6250, 0.3980], 'filled');
scatter([log(12/4)],[...
        log(abs(dot(beam_Bending_Q9_4x1_Al_under.interpolate_stress(6, 1) - stress, [1 0 0]))/abs(displacement)), ...
    ], 30, [0.3660, 0.9740, 0.4880], 'filled');

legend("Q4 Meshes", "Q8 Mesh", "Q9 Mesh", "Q8 under-integrated", "Q9 under-integrated");
title("Integration Point Dependency on \sigma_{xx} Error");
ylabel("ln(error)")
xlabel("ln(element size)")
%%
subplot(1,2,2)
plot(log_lengths, [...
        log(abs(dot(beam_Bending_Q4_4x1_Al.interpolate_stress(6, 1) - stress, [0 0 1.]))/abs(displacement)), ...
        log(abs(dot(beam_Bending_Q4_8x2_Al.interpolate_stress(6, 1) - stress, [0 0 1.]))/abs(displacement)), ...
        log(abs(dot(beam_Bending_Q4_16x4_Al.interpolate_stress(6, 1) - stress, [0 0 1.]))/abs(displacement)), ...
    ], '.-', 'MarkerSize', 20);
hold on
scatter([log(12/4)],[...
        log(abs(dot(beam_Bending_Q8_4x1_Al.interpolate_stress(6, 1) - stress, [0 0 1]))/abs(displacement)), ...
    ], 30, 	[0.8500, 0.3250, 0.0980], 'filled');
scatter([log(12/4)],[...
        log(abs(dot(beam_Bending_Q9_4x1_Al.interpolate_stress(6, 1) - stress, [0 0 1]))/abs(displacement)), ...
    ], 30, [0.4660, 0.6740, 0.1880], 'filled');

scatter([log(12/4)],[...
        log(abs(dot(beam_Bending_Q8_4x1_Al_under.interpolate_stress(6, 1) - stress, [0 0 1]))/abs(displacement)), ...
    ], 30, 	[1, 0.6250, 0.3980], 'filled');
scatter([log(12/4)],[...
        log(abs(dot(beam_Bending_Q9_4x1_Al_under.interpolate_stress(6, 1) - stress, [0 0 1]))/abs(displacement)), ...
    ], 30, [0.3660, 0.9740, 0.4880], 'filled');

title("Integration Point Dependency on \sigma_{xy} Error");
ylabel("ln(error)")
xlabel("ln(element size)")