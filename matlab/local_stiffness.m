function [K] = local_stiffness(X, Y, u, l, local_nodes)
  %local_stiffness Calculates the local stiffness for a given element and its
  % type, using an appropriate integration method.
  % NOTE: THIS IS GENERATED CODE. REFER TO local_stiffness.m.tmpl
  if local_nodes == 4
    K = crunch_quad(X(1), X(2), X(3), X(4), ...
                      Y(1), Y(2), Y(3), Y(4), u, l);
  else
    K = crunch_serindipity(X(1), X(2), X(3), X(4), ...
                           X(5), X(6), X(7), X(8), ...
                           Y(1), Y(2), Y(3), Y(4), ...
                           Y(5), Y(6), Y(7), Y(8), u, l);
  end
  K = K + triu(K, 1).';
end

function [K] = crunch_quad(A, B, C, D, S, T, U, V, u, l)
  K = [x97*(x58*(u*x27 + x0*x15) + x59*(x52*(x49*(u*x96 + x0*x91) + x56*(u*x86 +  ...
    x0*x80)) + x74*(u*x73 + x0*x66))), x97*(x58*(x26*x98 + x26*x99) + x59*(x52*(x49* ...
    (x104*x95 + x105*x90) + x56*(x102*x85 + x103*x79)) + x74*(x100*x65 + x101*x72))), x97*(x ...
    58*(x107*x14 + x110*x26) + x59*(x49*(x52*(x121*x90 + x124*x95) + x56*(x115*x116 + x118*x119) ...
    ) + x57*(x103*x114 + x112*x79))), x97*(x58*(x109*x98 + x125*x26) + x59*(x52*(x49*(x104*x ...
    123 + x105*x120) + x56*(x102*x114 + x103*x111)) + x74*(x118*x126 + x127*x72))), x97*(x58*(x129 ...
    *x130 + x131*x132) + x59*(x52*(x49*(x142*x143 + x145*x95) + x56*(x138*x79 + x140*x85)) + x ...
    74*(x116*x134 + x119*x135))), x97*(x58*(x131*x98 + x146*x26) + x59*(x52*(x49*(x105*x142 + x ...
    148*x90) + x56*(x102*x139 + x103*x137)) + x74*(x126*x135 + x147*x72))), x97*(x58*(x130*x149 + ...
     x132*x150) + x59*(x154*(x143*x151 + x153*x95) + x56*(x49*(x116*x155 + x157*x72) + x52*(x0* ...
    x159 + x103*x160)))), x97*(x58*(x150*x98 + x161*x26) + x59*(x52*(x49*(x105*x151 + x163*x90) ...
     + x56*(x102*x160 + x103*x158)) + x74*(x126*x156 + x162*x72))); 0, x97*(x58*(u*x15 + x0 ...
    *x27) + x59*(x52*(x49*(u*x91 + x0*x96) + x56*(u*x80 + x0*x86)) + x74*(u*x66 +  ...
    x0*x73))), x97*(x58*(x109*x99 + x164*x26) + x59*(x49*(x52*(x124*x90 + x167*x95) + x56* ...
    (x100*x115 + x101*x118)) + x57*(x111*x165 + x166*x79))), x97*(x58*(x125*x14 + x168*x26) + x ...
    59*(x52*(x49*(u*x120*x90 + x123*x170) + x56*(x114*x171 + x172*x79)) + x74*(x118*x169 + x127* ...
    x65))), x97*(x58*(x131*x99 + x173*x26) + x59*(x52*(x49*(x145*x90 + x175*x95) + x56*(x137 ...
    *x165 + x140*x79)) + x74*(x101*x135 + x174*x72))), x97*(x58*(x129*x99 + x131*x176) + x59*( ...
    x52*(x49*(x144*x170 + x178*x90) + x56*(x139*x171 + x177*x79)) + x74*(x135*x169 + x147*x65))) ...
    , x97*(x58*(x150*x99 + x179*x26) + x59*(x52*(x49*(x153*x90 + x181*x95) + x56*(x158*x165 + ...
     x180*x79)) + x74*(x100*x155 + x157*x65))), x97*(x58*(x149*x99 + x150*x176) + x59*(x52*(x ...
    49*(x152*x170 + x182*x90) + x56*(u*x159 + x160*x171)) + x74*(x101*x155 + x156*x169))); 0, 0 ...
    , x97*(x58*(u*x184 + x0*x183) + x59*(x154*(u*x186 + x0*x185) + x56*(x49*(u*x188 + x0 ...
    *x187) + x52*(u*x190 + x0*x189)))), x97*(x58*(x109*x125 + x109*x164) + x59*(x52*(x49*(x ...
    120*x124 + x123*x167) + x56*(x111*x166 + x111*x192)) + x74*(x118*x127 + x118*x191))), x97*(x58* ...
    (x107*x129 + x110*x131) + x59*(x52*(x49*(u*x195 + x121*x142) + x56*(x111*x138 + x114*x140)) + ...
     x74*(u*x194 + x115*x193))), x97*(x58*(x109*x146 + x131*x164) + x59*(x52*(x49*(x120*x148 +  ...
    x124*x142) + x56*(x111*x196 + x137*x166)) + x74*(x118*x147 + x135*x191))), x97*(x58*(x107*x149  ...
    + x110*x150) + x59*(x52*(x49*(x121*x151 + x123*x153) + x56*(u*x197 + x112*x158)) + x74*(x0 ...
    *x115*x155 + x118*x157))), x97*(x58*(x109*x161 + x150*x164) + x59*(x52*(x49*(x120*x163 + x124* ...
    x151) + x56*(x111*x198 + x158*x166)) + x74*(x118*x162 + x156*x191))); 0, 0, 0, x97*(x58*( ...
    u*x183 + x0*x184) + x59*(x52*(x49*(u*x185 + x0*x186) + x56*(u*x189 + x0*x190)) + x74 ...
    *(u*x187 + x0*x188))), x97*(x58*(x109*x173 + x125*x131) + x59*(x52*(x49*(x120*x145 + x123* ...
    x175) + x56*(x111*x140 + x137*x192)) + x74*(x118*x174 + x127*x135))), x97*(x58*(x125*x129 + x ...
    131*x168) + x59*(x52*(x49*(x0*x195 + x120*x178) + x56*(x111*x177 + x114*x199)) + x74*(x0*x ...
    194 + x115*x147))), x97*(x58*(x109*x179 + x125*x150) + x59*(x49*(x52*(x120*x153 + x123*x181) + ...
     x56*(x115*x157 + x118*x200)) + x57*(x111*x180 + x158*x192))), x97*(x58*(x125*x149 + x150*x168) ...
     + x59*(x52*(x49*(x120*x182 + x123*x202) + x56*(x0*x197 + x158*x172)) + x74*(x118*x201 + x ...
    127*x155))); 0, 0, 0, 0, x97*(x58*(u*x204 + x0*x203) + x59*(x52*(x49*(u*x208 + x0* ...
    x207) + x56*(u*x210 + x0*x209)) + x74*(u*x206 + x0*x205))), x97*(x58*(x131*x146 + x131* ...
    x173) + x59*(x154*(x142*x145 + x142*x148) + x56*(x49*(x135*x147 + x135*x174) + x52*(x137*x140 + ...
     x137*x196)))), x97*(x58*(u*x212 + x0*x211) + x59*(x52*(x49*(x0*x142*x151 + x145*x152) + ...
     x56*(x138*x158 + x140*x160)) + x74*(x135*x157 + x155*x193))), x97*(x58*(u*x213 + x150*x173)  ...
    + x59*(x52*(x49*(x142*x163 + x145*x151) + x56*(x137*x198 + x140*x158)) + x74*(x135*x162 + x156 ...
    *x174))); 0, 0, 0, 0, 0, x97*(x58*(u*x203 + x0*x204) + x59*(x52*(x49*(u*x207 + x ...
    0*x208) + x56*(u*x209 + x0*x210)) + x74*(u*x205 + x0*x206))), x97*(x58*(l*x213 + x146 ...
    *x150) + x59*(x52*(x49*(x142*x153 + x148*x151) + x56*(x137*x180 + x158*x196)) + x74*(x134*x157 ...
     + x135*x200))), x97*(x58*(u*x211 + x0*x212) + x59*(x52*(x49*(x142*x182 + x144*x202) + x ...
    56*(x158*x177 + x160*x199)) + x74*(x135*x201 + x147*x155))); 0, 0, 0, 0, 0, 0, x97*(x58 ...
    *(u*x215 + x0*x214) + x59*(x52*(x49*(u*x221 + x0*x220) + x56*(u*x219 + x0*x218)) +  ...
    x74*(u*x217 + x0*x216))), x97*(x58*(x150*x161 + x150*x179) + x59*(x52*(x49*(x151*x153 + x ...
    151*x163) + x56*(x158*x180 + x158*x198)) + x74*(x155*x157 + x156*x200))); 0, 0, 0, 0, 0,  ...
    0, 0, x97*(x58*(u*x214 + x0*x215) + x59*(x52*(x49*(u*x220 + x0*x221) + x56*(u*x218  ...
    + x0*x219)) + x74*(u*x216 + x0*x217)))];
end

function [K] = crunch_serindipity(A, B, C, D, E, F, G, H, ...
                                  S, T, U, V, W, X, Y, Z, u, l)
  K = [];
end

